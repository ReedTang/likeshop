(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["bundle-pages-user_set-user_set"],{"11cc":function(e,t,i){var n=i("c86c");t=n(!1),t.push([e.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */.user-profile-container .user-profile[data-v-6f775128]{border-top-left-radius:%?28?%;border-top-right-radius:%?28?%}.user-profile-container .user-profile .user-avatar-box[data-v-6f775128]{padding:%?30?%;background-color:#fff;border-top-left-radius:%?28?%;border-top-right-radius:%?28?%}.user-profile-container .user-profile .user-avatar-box .user-avatar[data-v-6f775128]{width:%?120?%;height:%?120?%;border-radius:50%}.user-profile-container .user-profile .row-info[data-v-6f775128]{padding:%?30?% %?20?%;background-color:#fff}.user-profile-container .user-profile .row-info .label[data-v-6f775128]{width:%?180?%}.user-profile-container .user-profile .row-info .bd-btn[data-v-6f775128]{padding:%?8?% %?24?%;border:1px solid #ff2c3c;color:#ff2c3c}.user-profile-container .user-profile .license[data-v-6f775128]{margin-top:%?80?%;color:#a7a7a7;text-align:center}.user-profile-container .user-profile .bdb-line[data-v-6f775128]{border-bottom:%?1?% solid #e5e5e5}.user-profile-container .user-profile .save-btn[data-v-6f775128]{margin-top:%?40?%;height:%?88?%;margin-left:%?54?%;margin-right:%?54?%;border-radius:%?10?%;box-sizing:border-box}.user-profile-container .user-profile .updata-btn[data-v-6f775128]{margin:0 %?30?%;margin-top:%?40?%;background-color:#0cc267}.user-profile-container .modify-container[data-v-6f775128]{padding-left:%?30?%;padding-right:%?30?%;padding-bottom:%?30?%;width:%?580?%;border-radius:%?30?%;background-color:#fff}.user-profile-container .modify-container .title[data-v-6f775128]{padding:%?26?% %?0?%}.user-profile-container .modify-container .modify-row[data-v-6f775128]{padding:%?32?% %?0?%;width:100%;border-bottom:%?1?% solid #e5e5e5}.user-profile-container .modify-container .modify-row .send-code-btn[data-v-6f775128]{border:1px solid #ff2c3c;width:%?184?%;height:%?62?%;color:#ff2c3c}.user-profile-container .modify-container .btn[data-v-6f775128]{height:%?80?%;padding:0 %?180?%;border-radius:%?20?%;margin-top:%?60?%}',""]),e.exports=t},1832:function(e,t,i){"use strict";i.r(t);var n=i("1aa8"),o=i.n(n);for(var s in n)["default"].indexOf(s)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(s);t["default"]=o.a},"1aa8":function(e,t,i){"use strict";(function(e){i("6a54");var n=i("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(i("9b1b")),s=n(i("2634")),a=n(i("2fdc")),r=i("04d9"),l=i("22c5"),c=i("c3f8"),u=i("ec91"),d=i("8f59"),f=i("a30b"),v=(i("f7dc"),{NONE:"",SEX:"sex",NICKNAME:"nickname",AVATAR:"avatar",MOBILE:"mobile"}),p={name:"userProfile",data:function(){return{version:l.version,fileList:[],userInfo:{},new_mobile:"",smsCode:"",newNickname:"",sexList:["男","女"],fieldType:v.NONE,showPicker:!1,showMobile:!1,showPwd:!1,showNickName:!1,tips:"",canSendSms:!0,pwd:"",comfirmPwd:"",smsType:u.SMSType.FINDPWD,code:""}},methods:{codeChange:function(e){this.tips=e},onChooseAvatar:function(e){this.fieldType=v.AVATAR,uni.$u.route({url:"/components/uview-ui/components/u-avatar-cropper/u-avatar-cropper",params:{destWidth:300,rectWidth:200,fileType:"jpg"}})},changeNameConfirm:function(e){var t=this;return(0,a.default)((0,s.default)().mark((function i(){return(0,s.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(t.fieldType=v.NICKNAME,t.newNickname=e.detail.value.nickname,t.newNickname){i.next=4;break}return i.abrupt("return",t.$toast({title:"请输入新的昵称"}));case 4:return i.next=6,t.$setUserInfo(t.newNickname);case 6:t.showNickName=!1;case 7:case"end":return i.stop()}}),i)})))()},logout:function(){var e=this;(0,r.userLogout)({token:this.token}).then((function(t){1==t.code&&(e.$store.commit("LOGOUT"),e.$toast({title:"退出成功"}),setTimeout((function(){uni.redirectTo({url:"/pages/login/login"})}),500))}))},goToExplain:function(e){uni.navigateTo({url:"/bundle/pages/server_explan/server_explan?type="+e})},goLicense:function(){uni.navigateTo({url:"/bundle/pages/license/license"})},toSetPayPwd:function(){if(!this.userInfo.mobile)return this.$toast({title:"请先设置手机号"});uni.navigateTo({url:"/bundle/pages/set_pay_pwd/set_pay_pwd"})},$sendSms:function(e){var t=this;this.canSendSms&&(0,c.sendSms)({mobile:this.userInfo.mobile||this.new_mobile,key:this.smsType}).then((function(e){1==e.code&&(t.$toast({title:e.msg}),t.$refs.uCode.start())}))},$getUserInfo:function(){var e=this;(0,r.getUserInfo)().then((function(t){1==t.code&&(e.userInfo=t.data)}))},showModifyMobile:function(){this.smsCode="",this.new_mobile="",this.showMobile=!0,this.smsType=this.userInfo.mobile?u.SMSType.CHANGE_MOBILE:u.SMSType.BIND},$changeUserMobile:function(){var e=this;this.smsCode?this.new_mobile?(0,r.changeUserMobile)({mobile:this.userInfo.mobile,new_mobile:this.new_mobile,code:this.smsCode,action:this.userInfo.mobile?"change":""}).then((function(t){1==t.code&&(e.showMobile=!1,e.$toast({title:t.msg}),e.$getUserInfo())})):this.$toast({title:"请输入新的手机号码"}):this.$toast({title:"请输入验证码"})},$setUserInfo:function(e){var t=this;return(0,a.default)((0,s.default)().mark((function i(){var n;return(0,s.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,(0,r.setUserInfo)({field:t.fieldType,value:e});case 2:n=i.sent,1==n.code&&(t.$toast({title:n.msg}),t.$getUserInfo());case 4:case"end":return i.stop()}}),i)})))()},timeChange:function(t){e.log(t,"timestamp")},onConfirm:function(e){this.$setUserInfo(e[0]+1),this.showPicker=!1},changeSex:function(e){this.showPicker=!0,this.fieldType=v.SEX},countDownFinish:function(){this.canSendSms=!0},showPwdPop:function(){this.userInfo.mobile?(this.smsCode="",this.smsType=u.SMSType.FINDPWD,this.showPwd=!0):this.$toast({title:"请绑定手机后再设置密码"})},$forgetPwd:function(){var e=this,t=this.smsCode,i=this.pwd,n=this.comfirmPwd;if(t)if(i)if(n)if(i==n){var o={mobile:this.userInfo.mobile,code:t,password:i,repassword:n};(0,c.forgetPwd)(o).then((function(t){1==t.code&&(e.showPwd=!1,e.$toast({title:"设置密码成功"}),e.$getUserInfo())}))}else this.$toast({title:"两次密码输入不一致"});else this.$toast({title:"再次输入新密码确认"});else this.$toast({title:"请输入新密码"});else this.$toast({title:"请填写短信验证码"})},changeName:function(){this.fieldType=v.NICKNAME,this.newNickname="",this.showNickName=!0},getPhoneNumber:function(e){var t=this;return(0,a.default)((0,s.default)().mark((function i(){var n,o,a,r;return(0,s.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:n=e.detail,o=n.encryptedData,a=n.iv,r={code:t.code,encrypted_data:o,iv:a},t.fieldType=v.MOBILE,o&&t.$changeUserMobileMP(r);case 4:case"end":return i.stop()}}),i)})))()},$changeUserMobileMP:function(e){var t=this;(0,r.changeUserMobile)(e).then((function(e){1==e.code&&(t.$toast({title:e.msg}),t.$getUserInfo())}))},uploadImage:function(e){var t=this;uni.showLoading({title:"正在上传中...",mask:!0}),(0,f.uploadFile)(e).then((function(e){uni.hideLoading(),t.$setUserInfo(e.url)})).catch((function(){uni.hideLoading(),t.$toast({title:"上传失败"})}))}},onLoad:function(){var t=this;this.$getUserInfo(),uni.$on("uAvatarCropper",(function(i){e.log(i),t.uploadImage(i)})),this.getUserProfile=(0,f.trottle)(this.getUserProfile,500,this)},onUnload:function(){uni.$off("uAvatarCropper")},computed:(0,o.default)((0,o.default)({},(0,d.mapState)(["token"])),(0,d.mapGetters)(["appConfig"]))};t.default=p}).call(this,i("ba7c")["default"])},"500b":function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){return n}));var n={uIcon:i("ab92").default,uPopup:i("1ed5").default,uVerificationCode:i("e03a").default,uFormItem:i("9c89").default,uPicker:i("260a").default},o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"user-profile-container mt10"},[i("v-uni-view",{staticClass:"user-profile"},[i("v-uni-view",{staticClass:"user-avatar-box column-center"},[i("v-uni-button",{staticClass:"column column-center",attrs:{"hover-class":"none","open-type":"chooseAvatar"},on:{chooseavatar:function(t){arguments[0]=t=e.$handleEvent(t),e.onChooseAvatar.apply(void 0,arguments)},click:function(t){arguments[0]=t=e.$handleEvent(t),e.onChooseAvatar.apply(void 0,arguments)}}},[i("v-uni-image",{staticClass:"user-avatar",attrs:{src:""!=e.userInfo.avatar?e.userInfo.avatar:"../../static/images/default_avatar.png"}}),i("v-uni-view",{staticClass:"muted xs"},[e._v("点击修改头像")])],1)],1),i("v-uni-view",{staticClass:"row-info row bdb-line"},[i("v-uni-view",{staticClass:"label md"},[e._v("ID")]),i("v-uni-view",{staticClass:"md row",staticStyle:{flex:"1"}},[e._v(e._s(e.userInfo.sn))])],1),i("v-uni-view",{staticClass:"row-info row bdb-line",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.changeName.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"label md"},[e._v("昵称")]),i("v-uni-view",{staticClass:"md row",staticStyle:{flex:"1"}},[e._v(e._s(e.userInfo.nickname))]),i("u-icon",{attrs:{name:"arrow-right"}})],1),i("v-uni-view",{staticClass:"row-info row bdb-line",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.changeSex()}}},[i("v-uni-view",{staticClass:"label md"},[e._v("性别")]),i("v-uni-view",{staticClass:"md row",class:0==e.userInfo.sex?"muted":"",staticStyle:{flex:"1"}},[e._v(e._s(0==e.userInfo.sex?"未设置":1==e.userInfo.sex?"男":"女"))]),i("u-icon",{attrs:{name:"arrow-right"}})],1),i("v-uni-view",{staticClass:"row-info row bdb-line"},[i("v-uni-view",{staticClass:"label md"},[e._v("手机")]),i("v-uni-view",{staticClass:"md row",class:{muted:!e.userInfo.mobile},staticStyle:{flex:"1"}},[e._v(e._s(e.userInfo.mobile?e.userInfo.mobile:"未绑定"))]),i("v-uni-view",{staticClass:"bd-btn br60 row-center",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.showModifyMobile.apply(void 0,arguments)}}},[e._v(e._s(e.userInfo.mobile?"更换手机号":"绑定手机号"))])],1),i("v-uni-view",{staticClass:"row-info row bdb-line"},[i("v-uni-view",{staticClass:"label md"},[e._v("注册时间")]),i("v-uni-view",{staticClass:"md row",staticStyle:{flex:"1"}},[e._v(e._s(e.userInfo.create_time))])],1)],1),i("u-popup",{attrs:{type:"center",closeable:!0,mode:"center","border-radius":"14"},model:{value:e.showMobile,callback:function(t){e.showMobile=t},expression:"showMobile"}},[i("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:e.showMobile,expression:"showMobile"}],staticClass:"modify-container column-center bg-white"},[i("v-uni-view",{staticClass:"title xl"},[e._v(e._s(e.userInfo.mobile?"更换手机号":"绑定手机号"))]),e.userInfo.mobile?i("v-uni-view",{staticClass:"modify-row row"},[i("v-uni-view",{staticStyle:{width:"56px","border-right":"1px solid #e5e5e5"}},[e._v("+86")]),i("v-uni-view",{staticStyle:{"margin-left":"15px"}},[e._v(e._s(e.userInfo.mobile))])],1):i("v-uni-view",{staticClass:"modify-row row"},[i("v-uni-view",{staticStyle:{width:"71px"}},[e._v("手机号")]),i("v-uni-input",{attrs:{placeholder:"请输入绑定手机号"},model:{value:e.new_mobile,callback:function(t){e.new_mobile=t},expression:"new_mobile"}})],1),i("v-uni-view",{staticClass:"modify-row row"},[i("v-uni-view",{staticStyle:{width:"71px"}},[e._v("验证码")]),i("v-uni-input",{staticStyle:{"padding-left":"5px",width:"130px"},attrs:{placeholder:"请输入验证码"},model:{value:e.smsCode,callback:function(t){e.smsCode=t},expression:"smsCode"}}),i("v-uni-view",{staticClass:"send-code-btn nr row-center",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.$sendSms.apply(void 0,arguments)}}},[i("u-verification-code",{ref:"uCode",attrs:{"keep-running":!0,"unique-key":"page-b"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.codeChange.apply(void 0,arguments)}}}),i("v-uni-view",{staticClass:"xs"},[e._v(e._s(e.tips))])],1)],1),e.userInfo.mobile?i("v-uni-view",{staticClass:"modify-row row"},[i("v-uni-view",{staticStyle:{width:"71px"}},[e._v("新手机号")]),i("v-uni-input",{attrs:{placeholder:"请输入新的手机号码"},model:{value:e.new_mobile,callback:function(t){e.new_mobile=t},expression:"new_mobile"}})],1):e._e(),i("v-uni-view",{staticClass:"primary mt10"},[e._v(e._s(e.userInfo.mobile?"更改":"绑定")+"手机号码成功后，您的账号将会变更为该设置号码")]),i("v-uni-view",{staticClass:"btn bg-primary white row-center",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.$changeUserMobile.apply(void 0,arguments)}}},[e._v("确定")])],1)],1),i("u-popup",{attrs:{closeable:!0,maskCloseAble:!1,mode:"center","border-radius":"14"},model:{value:e.showNickName,callback:function(t){e.showNickName=t},expression:"showNickName"}},[i("v-uni-view",{staticClass:"modify-container column-center bg-white",staticStyle:{width:"70vw",padding:"24rpx"}},[i("v-uni-view",{staticClass:"title xl"},[e._v("修改用户名")]),i("v-uni-form",{on:{submit:function(t){arguments[0]=t=e.$handleEvent(t),e.changeNameConfirm.apply(void 0,arguments)}}},[i("u-form-item",{attrs:{label:"新昵称",labelWidth:120}},[i("v-uni-input",{staticClass:"nr",staticStyle:{height:"60rpx"},attrs:{value:e.userInfo.nickname,name:"nickname",type:"nickname",placeholder:"请输入新的昵称"}})],1),i("v-uni-button",{staticClass:"btn bg-primary white row-center",attrs:{"form-type":"submit"}},[e._v("确定")])],1)],1)],1),i("u-popup",{attrs:{closeable:!0,mode:"center","border-radius":"14"},model:{value:e.showPwd,callback:function(t){e.showPwd=t},expression:"showPwd"}},[i("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:e.showPwd,expression:"showPwd"}],staticClass:"modify-container column-center bg-white"},[i("v-uni-view",{staticClass:"title xl"},[e._v("设置密码")]),i("v-uni-view",{staticClass:"modify-row row"},[i("v-uni-view",{staticStyle:{width:"56px","border-right":"1px solid #e5e5e5"}},[e._v("+86")]),i("v-uni-view",{staticStyle:{"margin-left":"15px"}},[e._v(e._s(e.userInfo.mobile))])],1),i("v-uni-view",{staticClass:"modify-row row"},[i("v-uni-view",{staticStyle:{width:"142rpx"}},[e._v("验证码")]),i("v-uni-input",{staticStyle:{"padding-left":"10rpx",width:"260rpx"},attrs:{placeholder:"请输入验证码"},model:{value:e.smsCode,callback:function(t){e.smsCode=t},expression:"smsCode"}}),i("v-uni-view",{staticClass:"send-code-btn nr row-center",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.$sendSms.apply(void 0,arguments)}}},[i("u-verification-code",{ref:"uCode",attrs:{"keep-running":!0,"unique-key":"page-a"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.codeChange.apply(void 0,arguments)}}}),i("v-uni-view",{staticClass:"xs"},[e._v(e._s(e.tips))])],1)],1),i("v-uni-view",{staticClass:"modify-row row"},[i("v-uni-view",{staticStyle:{width:"71px"}},[e._v("设置密码")]),i("v-uni-input",{attrs:{type:"password",placeholder:"请输入新密码"},model:{value:e.pwd,callback:function(t){e.pwd=t},expression:"pwd"}})],1),i("v-uni-view",{staticClass:"modify-row row"},[i("v-uni-view",{staticStyle:{width:"71px"}},[e._v("确认密码")]),i("v-uni-input",{attrs:{type:"password",placeholder:"再次输入新密码确认"},model:{value:e.comfirmPwd,callback:function(t){e.comfirmPwd=t},expression:"comfirmPwd"}})],1),i("v-uni-view",{staticClass:"btn bg-primary white row-center",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.$forgetPwd.apply(void 0,arguments)}}},[e._v("确定")])],1)],1),i("u-picker",{attrs:{mode:"selector","default-selector":[0],range:e.sexList},on:{confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.onConfirm.apply(void 0,arguments)}},model:{value:e.showPicker,callback:function(t){e.showPicker=t},expression:"showPicker"}})],1)},s=[]},7460:function(e,t,i){var n=i("11cc");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var o=i("967d").default;o("d2ed429c",n,!0,{sourceMap:!1,shadowMode:!1})},8242:function(e,t,i){"use strict";var n=i("7460"),o=i.n(n);o.a},aade:function(e,t,i){"use strict";i.r(t);var n=i("500b"),o=i("1832");for(var s in o)["default"].indexOf(s)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(s);i("8242");var a=i("828b"),r=Object(a["a"])(o["default"],n["b"],n["c"],!1,null,"6f775128",null,!1,n["a"],void 0);t["default"]=r.exports}}]);